self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.931.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[931],{15614:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n(2302),i=n(1121),a=n(1808),d=n(1715),u=n(75),s=n(961),c=n(989),l=n(2104);function f(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(o.__generator)(this,(function(o){return 1===(n=t.tableQuery).listViewType?(r={Id:e,mailboxInfo:Object(i.d)(n)},[2,d.e.importAndExecute(r,"LoadNudgedItem")]):[2,b(e,t)]}))}))}function b(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,f,b;return Object(o.__generator)(this,(function(o){return n=t.tableQuery,f=Object(i.d)(n),b=Object(l.a)()&&"inbox"==Object(c.a)(n.folderId)?0:-1,[2,a.k.importAndExecute(Object(s.i)(n),e,Object(r.a)(n),n.requestShapeName,f.requestOptions,b).then((function(t){if("Success"==t.ResponseClass){var n=t.Conversations;if(n&&n.length>0&&n[0].ConversationId.Id===e){var o={Id:e,mailboxInfo:f};return d.d.importAndExecute(o,"LoadNudgedConversation"),n[0]}}return null})).catch((function(e){return u.g.warn("loadNudgedConversation throws an exception"+e.message),null}))]}))}))}var g=n(296),w=n(715),I="https://outlook.office.com/FocusedInboxB2";function m(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return[4,v()];case 1:return e=n.sent(),t=new Headers,e&&(t.authorization="Bearer "+e),[2,t]}}))}))}function v(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return Object(g.a)()?[2,null]:[2,Object(w.getAccessTokenforResource)(I)]}))}))}var O=n(288),h="FocusedInboxB2/api/v1/Nudges/GetNudges";function p(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,m()];case 1:return t=o.sent(),[4,Object(O.b)(h,e,!0,t)];case 2:n=o.sent(),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,n.json()];case 4:return[2,o.sent()];case 5:return o.sent(),[2,null];case 6:return[2]}}))}))}var j=n(3),y=n(964);function N(e){switch(e){case"Received":return 0;case"Sent":return 1;default:return u.g.warn("No nudge reason returned in GetNudge server response"),0}}var _=n(3342),R=n(2342),C=n(3999),K=n(9174),T=n(1833),x=n(1999);function A(e,t){var n=t.rowKeys.indexOf(e);if(-1!=n){var o=s.b.getLastDeliveryOrRenewTimeStamp(e,t);if(Object(x.a)(e,t.id,o)){var r=Object(C.a)(o,s.b.getLastDeliveryTimeStamp(e,t),t,n+1);-1==r?Object(R.a)([e],t,"NotNudgeAnymore"):(Object(K.a)([e],t),T.a.updateRowPosition(--r,e,t))}}}var S=n(254),V=n(115),D=n(435),E=n(3433),L=n(1442),M=n(982),P=n(7);function k(e,t,n){Object(S.o)("Nudge_RowRemove",{owa_1:t,owa_2:n,rKey:e},{isCore:!0})}var F,U,Q=n(6770),G=n(76),z=!1,B={},H=36e5,J=18e5,q=Object(V.e)(Q.a,"getNudgesOnNudgeOptionChangeClone",(function(e){$(!0,"SettingChange")})),Y=Object(V.e)(E.a,"clone_onSelectFolderComplete",(function(e){var t=e.selectedFolderId,n=e.previousFolderId,o=e.isExitingSearch;t==n||o||$(!1,"FolderSwitch")})),W=Object(V.e)(x.h,"clone_getNudgesOnNudgeRemoved",(function(e){Object(G.h)("tri-nudgePolling")&&(U=setTimeout((function(){return $(!0,"NudgeRemoval")}),3e4))}));function Z(e,t){"visible"===document.visibilityState&&$(e,t)}function $(e,t){if(!z&&Object(_.b)()){var n=Object(G.h)("tri-nudgePolling");!F&&n&&(F=!0,document.addEventListener("visibilitychange",(function(){return Z(!1,"VisibilityChange")})));var r=Object(s.C)(),i=r.tableQuery.folderId;if(Object(_.a)(i)){if(n){if(!e&&Date.now()-B[i]<=J)return;U&&(clearTimeout(U),U=null),U=setTimeout((function(){return Z(!1,"Timer")}),H)}!function(e,t,n){Object(o.__awaiter)(this,void 0,void 0,(function(){var r,i,a,d,l,f,b,g,w,I,m,v,O,h,N,_,R,C;return Object(o.__generator)(this,(function(K){switch(K.label){case 0:return z=!0,r=Object(D.a)(),i=Date.now(),[4,p(r)];case 1:a=K.sent(),d=a?Date.now()-i:-1,l=[],f=(null==a?void 0:a.Nudges)||[],b=0,g=[],w=[],I="sentitems"==Object(c.a)(e),m=0,K.label=2;case 2:return m<f.length?(v=f[m],O=v.FolderId.Id,h=v.ItemId.Id,g.push(h),I&&O!=e?[3,4]:[4,X(v,t,r)]):[3,5];case 3:(N=K.sent())&&(l.push(N),w.push(h)),b++,K.label=4;case 4:return m++,[3,2];case 5:return Object(S.o)("Nudge_GetNudge",{owa_1:f.length,owa_2:b,owa_3:l.length,owa_4:n,cId:r,itemId:g.join(","),latency:d,validItemId:w.join(",")}),_=Object(j.a)("testOldNudge"),0!=decodeURIComponent(_||"").trim().length&&(l.push({rowKey:"testNudgeRowKey",itemId:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId=",conversationId:"getTestNudgeRowDataForRowNotLoadedInTableViewConversationId=",tableViewId:t.id,reason:0,daysAgo:7}),R={ConversationId:{__type:"ItemId:#Exchange",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewConversationId="},ConversationTopic:"This is a test Nudge Email that is older than the loaded rows",UniqueSenders:["Sayali Shah"],LastDeliveryTime:"2019-10-01T15:30:58-07:00",HasAttachments:!1,MessageCount:1,GlobalMessageCount:1,UnreadCount:1,GlobalUnreadCount:1,Size:1234,ItemClasses:["IPM.Note"],Importance:null,ItemIds:[{__type:"ItemId:#Exchange",ChangeKey:"CQAAAA==",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId="}],GlobalItemIds:[{__type:"ItemId:#Exchange",ChangeKey:"CQAAAA==",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId="}],LastModifiedTime:"2019-10-29T15:30:59-07:00",InstanceKey:"testNudgeRowKey",Preview:"Test nudge email for row that is not loaded",HasIrm:!1,IsLocked:!1,FamilyId:{__type:"ItemId:#Exchange",Id:"AAQkAGZjM2NmMGY1LTkzMzgtNGNhMy04ODg5LWQwMjJjMDc0YjJlMAAQAH9+ZbR0rbRFncY81mWHT1E="},LastDeliveryOrRenewTime:"2019-10-01T15:30:58-07:00",HasAttachmentPreviews:!1,LastSender:{Mailbox:{Name:"Sayali Shah",EmailAddress:"sayalis@microsoft.com",RoutingType:"SMTP"}}},t.rowKeys.indexOf("testNudgeRowKey")<0&&(C=Object(L.f)(t,0),T.a.addRow(C,R,t))),l.push.apply(l,Object(o.__spread)(function(e){var t=Object(j.a)("testNudge");if(0==decodeURIComponent(t||"").trim().length)return[];var n=[];if(e.rowKeys.length>0){var o=e.tableQuery.folderId===Object(y.a)("sentitems")?1:0,r={rowKey:e.rowKeys[4],itemId:s.b.getItemIds(e.rowKeys[0],e)[0],conversationId:s.b.getConversationId(e.rowKeys[4],e),tableViewId:e.id,reason:o,daysAgo:1};if(n.push(r),e.rowKeys.length>3){var i={rowKey:e.rowKeys[6],itemId:s.b.getItemIds(e.rowKeys[3],e)[0],conversationId:s.b.getConversationId(e.rowKeys[6],e),tableViewId:e.id,reason:o,daysAgo:0};n.push(i)}if(e.rowKeys.length>10&&1===Math.floor(2*Math.random())){var a={rowKey:e.rowKeys[10],itemId:s.b.getItemIds(e.rowKeys[10],e)[0],conversationId:s.b.getConversationId(e.rowKeys[10],e),tableViewId:e.id,reason:o,daysAgo:3};n.push(a)}}return n}(t))),Object(x.e)().nudgedRows.forEach((function(e){var n=e.rowKey;e.tableViewId!=t.id||l.some((function(t){return t.rowKey===n&&t.tableViewId===e.tableViewId}))||(A(n,t),k(n,"NotReceivedAsNudgeAnyMore",e.reason)),e.tableViewId!=t.id&&l.push(e)})),Object(x.g)(l,t),u.g.info("Nudge: onSelectFolderCompleteOrchestrator new nudges length: "+l.length),z=!1,[2]}}))}))}(i,r,t),B[i]=Date.now()}}}function X(e,t,n){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,a,c,l,b,g,w,I,m,v,O;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),r=e.ItemId.Id,a=e.ConversationId.Id,c=Object(s.L)(t),l=c?a:r,b=void 0,0!==(g=Object(s.A)([l],t)).length?[3,2]:[4,f(l,t)];case 1:return(w=o.sent())?(b=w.InstanceKey,t.rowKeys.indexOf(b)<0&&(I=Object(L.f)(t,0),T.a.addRow(I,w,t)),[3,3]):(u.g.warn("Nudge: Unable to load nudged row for list view type:"+t.tableQuery.listViewType+" itemId: "+r+" conversationId: "+a+" folderId: "+t.tableQuery.folderId),ee("RowNotFound",r,a,n,c),[2,null]);case 2:b=g[0],s.b.getIsPinned(b,t)&&ee("RowPinned",r,a,n,c),function(e,t){if(1===e.listViewType){var n=Object(M.b)().items.get(t);n&&n.NormalizedBody||d.e.importAndExecute({Id:t,mailboxInfo:Object(i.d)(e)},"LoadNudgedItem")}else Object(M.b)().conversations.get(t)||d.d.importAndExecute({Id:t,mailboxInfo:Object(i.d)(e)},"LoadNudgedConversation")}(t.tableQuery,l),o.label=3;case 3:return m=e.MessageReceivedOrSentTimeUTC||s.b.getLastDeliveryTimeStamp(b,t),v=Object(P.s)(Object(P.mc)(),Object(P.mc)(m)),[2,{rowKey:b,itemId:r,conversationId:a,tableViewId:t.id,reason:N(e.NudgeReason.Reason),daysAgo:v}];case 4:return O=o.sent(),u.g.warn("Nudge: processNudgeResponse throws an exception"+O.message),[2,null];case 5:return[2]}}))}))}function ee(e,t,n,o,r){Object(S.o)("Nudge_Discarded",{owa_1:e,owa_2:r,itemId:t,cId:n,crId:o})}var te=n(280),ne="FocusedInboxB2/api/v1/Nudges/UpdateNudge";function oe(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,r,i;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,m()];case 1:return n=o.sent(),r={ItemId:{Id:e},NudgeAction:t},[4,Object(O.d)(ne,r,Object(D.a)(),!1,n)];case 2:i=o.sent();try{Object(te.a)(i.status)||u.g.warn("updateNudgesOperation return http status "+i.status)}catch(e){return u.g.info("updateNudgesOperation return error "+e.message),[2,null]}return[2]}}))}))}var re=n(1685),ie=n(3587),ae=n(3588),de=n(6374),ue=n(6769),se=n(7827),ce=n(2987),le=Object(V.e)(se.b,"clone_onNudgeInfoBarClicked",(function(e){var t=e.response===se.a.MarkComplete?"MarkedComplete":"DismissedOnView";he(e.rowKey,e.itemId,t,"ReadingPane")})),fe=Object(V.e)(ue.a,"clone_onDismissNudgeClicked",(function(e){Object(x.e)().nudgedRows.filter((function(t){return t.rowKey===e.rowKey&&t.tableViewId===e.tableViewId})).forEach((function(t){he(e.rowKey,t.itemId,"Dismissed",e.actionSource)}))})),be=Object(V.e)(ae.a,"clone_markItemsAsPinnedStoreUpdate",(function(e){Oe(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned)})),ge=Object(V.e)(ie.a,"clone_markConversationsAsPinnedStoreUpdate",(function(e){Oe(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned)})),we=Object(V.e)(re.a,"clone_deleteItemsStoreUpdate",(function(e){e.itemContexts.map((function(e){return e.itemId})).forEach((function(t){var n=Object(x.d)(t);n&&(Object(x.h)(n),k(n,e.actionType,ye(n)))}))})),Ie=Object(V.e)(R.a,"clone_removeRowsFromListViewStore",(function(e){je(e.rowKeys,e.tableView.id,e.actionType)})),me=Object(V.e)(de.a,"clone_onSendMessageSucceeded",(function(e){var t=e.operation;if(1===t||2===t||3===t){e.referenceItemId||u.g.warn("Nudge: referenceItemId should not be null for r/R/f operations");var n=e.referenceItemId.Id,o=e.conversationId,r=Object(x.d)(n);if(r||(r=Object(x.c)(o)),r){A(r,Object(s.C)());var i=ye(r);Object(x.h)(r),Object(S.o)("Nudge_Reply",{owa_1:t,owa_2:i,refId:n,cId:o,rKey:r},{isCore:!0})}}})),ve=Object(V.e)(Q.a,"updateNudgesOnNudgeOptionChangeClone",(function(e){if(Object(ce.a)(16)){var t=Object(x.e)().nudgedRows.map((function(e){return e.rowKey})),n=Object(s.C)();t.forEach((function(e){A(e,n),je([e],n.id,"NudgeDisabled")}))}}));function Oe(e,t,n){var o=n?"Pinned":"Unpinned";e.forEach((function(e){Object(x.e)().nudgedRows.filter((function(n){return n.rowKey===e&&n.tableViewId===t})).forEach((function(e){oe(e.itemId,o),pe(o,"PinUnpin",e.reason,e.itemId)}))})),je(e,t,"PinUnpin")}function he(e,t,n,o){oe(t,n),A(e,Object(s.C)());var r=ye(e);Object(x.h)(e),pe(n,o,r,t)}function pe(e,t,n,o){Object(S.o)("Nudge_Update",{owa_1:e,owa_2:t,owa_3:n,itemId:o},{isCore:!0})}function je(e,t,n){e.forEach((function(e){if(Object(x.f)(e,t)){var o=ye(e);Object(x.h)(e),k(e,n,o)}}))}function ye(e){var t=Object(x.e)().nudgedRows.filter((function(t){return t.rowKey===e}));return t.length>0?t[0].reason:null}var Ne=n(4);function _e(e,t,n){if(e.tableViewId==t.id){var o,r="Nudge_Render",i=e.rowKey,a=e.conversationId,d=e.itemId;Object(x.a)(i,t.id,s.b.getLastDeliveryOrRenewTimeStamp(i,t))?(o=Object(L.f)(t,0),T.a.updateRowPosition(o,i,t),u.g.info("Nudge: "+n+" updateNudgedRowPosition - row is inserted at "+o)):(r="Nudge_NotRender",u.g.info("Nudge: "+n+" updateNudgedRowPosition - row is pinned")),Object(S.o)(r,{owa_1:n,rKey:i,iId:d,cId:a,index:o},{isCore:!0})}}Object(Ne.orchestrator)(x.g,(function(e){e.nudgedRows.forEach((function(t){return _e(t,e.tableView,"onGetNudge")}))})),Object(Ne.orchestrator)(L.i,(function(e){var t=Object(x.e)().nudgedRows,n=e.tableView;t.filter((function(e){return e.tableViewId==n.id})).forEach((function(t){return _e(t,e.tableView,"onMerge")}))})),n.d(t,"getNudgesOnSelectFolderComplete",(function(){return Y})),n.d(t,"getNudgesOnNudgeOptionChange",(function(){return q})),n.d(t,"getNudgesOnNudgeRemoved",(function(){return W})),n.d(t,"removeNudgeOnInfoBarClickedOrchestrator",(function(){return le})),n.d(t,"removeNudgeOnDismissNudgeClickedOrchestrator",(function(){return fe})),n.d(t,"removeNudgeOnItemDeleteStoreUpdateOrchestrator",(function(){return we})),n.d(t,"removeNudgeOnRowsDeleteStoreUpdateOrchestrator",(function(){return Ie})),n.d(t,"removeNudgeOnItemsPinnedStoreUpdateOrchestrator",(function(){return be})),n.d(t,"removeNudgeOnConversationsPinnedStoreUpdateOrchestrator",(function(){return ge})),n.d(t,"removeNudgeOnReplyOrReplyAllOrForwardOrchestrator",(function(){return me})),n.d(t,"updateNudgesOnNudgeOptionChange",(function(){return ve}))},240:function(e,t,n){"use strict";function o(){var e=Object.create(null),t=0,n=0,o=0,r=!1;function i(t){o--,delete e[t]}this.put=function(t,n,r,a){if(void 0!==r&&("number"!=typeof r||isNaN(r)||r<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==a&&"function"!=typeof a)throw new Error("Cache timeout callback must be a function");var d=e[t];d?clearTimeout(d.timeout):o++;var u={value:n,expire:r+Date.now()};return isNaN(u.expire)||(u.timeout=setTimeout(function(){i(t),a&&a(t,n)}.bind(this),r)),e[t]=u,n},this.del=function(t){var n=!0,o=e[t];return o?(clearTimeout(o.timeout),!isNaN(o.expire)&&o.expire<Date.now()&&(n=!1)):n=!1,n&&i(t),n},this.clear=function(){for(var i in e)clearTimeout(e[i].timeout);o=0,e=Object.create(null),r&&(t=0,n=0)},this.get=function(i){var a=e[i];if(void 0!==a){if(isNaN(a.expire)||a.expire>=Date.now())return r&&t++,a.value;r&&n++,o--,delete e[i]}else r&&n++;return null},this.size=function(){return o},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){r=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var o=e[n];t[n]={value:o.value,expire:o.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var o=JSON.parse(t),r=Date.now(),i=n&&n.skipDuplicates;for(var a in o)if(o.hasOwnProperty(a)){if(i)if(e[a])continue;var d=o[a],u=d.expire-r;if(u<=0){this.del(a);continue}u=u>0?u:void 0,this.put(a,d.value,u)}return this.size()}}e.exports=new o,e.exports.Cache=o},9174:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(1199),r=n(1378);function i(e,t){var n=e[e.length-1],i=t.rowKeys.indexOf(n);i<t.rowKeys.length-1?Object(o.r)(t,t.rowKeys[i+1],!1,r.a.RowRemoval):Object(o.j)(t,r.a.Reset)}}}]);
//# sourceMappingURL=owa.931.js.map
self.scriptsLoaded['owa.931.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.931.js'] = (new Date()).getTime();