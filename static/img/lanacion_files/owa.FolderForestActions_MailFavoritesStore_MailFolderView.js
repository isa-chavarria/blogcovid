self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.FolderForestActions~MailFavoritesStore~MailFolderView.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[57],{1313:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"ExtendedPropertyType:#Exchange"},e)}},3299:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"IsEqualTo:#Exchange"},e)}},4185:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"Folder:#Exchange"},e)}},4490:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"Or:#Exchange"},e)}},5254:function(e,t,r){"use strict";var n=r(7989),a=r(299),o=r(4185),s=r(1029),c=r(7990),d=r(245),i=r(75);var u=r(298),l=r(438),f=r(1609),b=r(2580),j=r(978),O=r(2608),p="PersonaId",I={PropertySetId:"{544b025e-cb61-4562-b021-16f4dcb2a7ac}",PropertyName:"Query",PropertyType:"String"},F={PropertySetId:"{1ffa50b8-9483-48df-ab40-de558669a5dc}",PropertyName:p,PropertyType:"String"};function g(){return Object(f.a)({BaseShape:"IdOnly",AdditionalProperties:[Object(j.a)({FieldURI:"UnreadCount"}),Object(j.a)({FieldURI:"TotalCount"}),Object(j.a)({FieldURI:"FolderDisplayName"}),Object(u.a)(I),Object(u.a)(F)]})}function v(e){return Object(O.a)({Header:Object(d.a)(),Body:Object(b.a)({FolderShape:g(),FolderIds:e.map((function(e){return Object(l.a)({Id:e})}))})}).then((function(e){return e.Body.ResponseMessages.Items.filter((function(e){return"Success"===e.ResponseClass})).map((function(e){return e.Folders[0]}))}))}var y=r(7991),h=r(1313),_=r(0);function m(e){return Object(_.__assign)({__type:"SearchFolder:#Exchange"},e)}var R="0x10f4",E=["msgfolderroot"];function P(e,t){return{ParentFolderId:{BaseFolderId:Object(l.a)({Id:e})},Folders:[m({DisplayName:t.displayName+"_"+t.favoriteNodeId,ExtendedProperty:(n=t.favoriteNodeId,o=E.join("_")+"_"+te.join("_")+"_v2",[Object(h.a)({ExtendedFieldURI:Object(u.a)(I),Value:o}),Object(h.a)({ExtendedFieldURI:Object(u.a)(F),Value:n}),Object(h.a)({ExtendedFieldURI:Object(u.a)({PropertyTag:R,PropertyType:"Boolean"}),Value:"true"})]),SearchParameters:(r={Restriction:re(t.allEmailAddresses),Traversal:"Deep",BaseFolderIds:E.map((function(e){return Object(a.a)({Id:e})}))},Object(_.__assign)({__type:"SearchParametersType:#Exchange"},r))})]};var r,n,o}function x(e){var t=e.ResponseMessages.Items[0];return new Promise((function(e,r){var n;"Success"==t.ResponseClass?e((n=t.Folders[0].FolderId.Id,Object(O.a)({Header:Object(d.a)(),Body:Object(b.a)({FolderShape:g(),FolderIds:[Object(l.a)({Id:n})]})}).then((function(e){return e.Body.ResponseMessages.Items[0].Folders[0]})))):"Error"===t.ResponseClass&&"ErrorFolderExists"===t.ResponseCode?(i.g.warn("Folder already exists"),r("ErrorFolderExists")):(i.g.warn("Error creating search folder "+t.MessageText),r(t.MessageText))}))}function w(e,t){return Object(c.a)(Object(y.a)({Header:Object(d.a)(),Body:Object(n.a)(P(e,t))})).then((function(e){return x(e.Body)}))}var S=r(7350),B=r(7792);function T(e,t){return 0===e.length||0===e.filter((function(e){return void 0!==e})).length?Promise.resolve():Object(B.a)({Header:Object(d.a)(),Body:Object(S.a)({DeleteType:t?"SoftDelete":"MoveToDeletedItems",FolderIds:e.filter((function(e){return void 0!==e})).map((function(e){return Object(l.a)({Id:e})}))})}).then((function(e){var t=e.Body.ResponseMessages.Items[0];return"Success"==t.ResponseClass?Promise.resolve():Promise.reject("Delete folder failed: "+t.ResponseClass)}))}var C=r(1544),M=r(1563),N=r(1779),U=r(3299),D=r(4490),V=r(1545),H=r(1766);function q(e,t){var r=e.map((function(e){return function(e){return Object(U.a)({FieldURIOrConstant:Object(M.a)({Item:Object(C.a)({Value:e})}),Item:Object(u.a)(F)})}(e)}));return Object(N.a)({FolderShape:g(),Paging:null,ParentFolderIds:[Object(l.a)({Id:t})],ReturnParentFolder:!0,ShapeName:"Folder",Traversal:"Deep",Restriction:Object(V.a)({Item:Object(D.a)({Items:r})})})}function L(e,t){return Object(H.a)({Header:Object(d.a)(),Body:q(e,t)}).then((function(e){return"Success"===e.Body.ResponseMessages.Items[0].ResponseClass?Promise.resolve(e.Body.ResponseMessages.Items[0].RootFolder.Folders):Promise.reject(e.Body.ResponseMessages.Items[0].ResponseCode+": "+e.Body.ResponseMessages.Items[0].MessageText)}))}function A(){return Object(H.a)({Header:Object(d.a)(),Body:Object(N.a)({FolderShape:g(),Paging:null,ParentFolderIds:[Object(a.a)({Id:"root"})],ReturnParentFolder:!0,ShapeName:"Folder",Traversal:"Deep",Restriction:Object(V.a)({Item:Object(U.a)({FieldURIOrConstant:Object(M.a)({Item:Object(C.a)({Value:"FavoritePersonas"})}),Item:Object(j.a)({FieldURI:"FolderDisplayName"})})})})}).then((function(e){var t=e.Body.ResponseMessages.Items[0].RootFolder.Folders;return new Promise((function(r,n){1===t.length?r(t[0]):t.length>1?(i.g.warn('More than one "FavoritePersonas" folder found.'),r(t[0])):0===t.length?r(void 0):(i.d(e.Body.ResponseMessages.Items[0].MessageText),n(e.Body.ResponseMessages.Items[0].MessageText))}))}))}function J(e){return function(e,t){var r=t.ExtendedProperty&&t.ExtendedProperty.filter((function(t){return t.ExtendedFieldURI&&t.ExtendedFieldURI.PropertyName===e}));if(r&&r.length>0)return r[0].Value}(p,e)}var $=r(254),z=r(435),Q="SynchronizePersonaSearchFolder";function k(e,t,r,n){return Object(_.__awaiter)(this,void 0,void 0,(function(){var a;return Object(_.__generator)(this,(function(o){switch(o.label){case 0:return[4,L([e.favoriteNodeId],t)];case 1:return a=o.sent(),[4,G(e,a,t,r,n)];case 2:return[2,o.sent()]}}))}))}function G(e,t,r,n,a){return Object(_.__awaiter)(this,void 0,void 0,(function(){var o,s,c;return Object(_.__generator)(this,(function(d){switch(d.label){case 0:o=function(e,t){var r=t.filter((function(t){return J(t)===e}));r.length>1&&i.d(r.length+" items were returned, one was expected");return 1===r.length&&r[0]}(e.favoriteNodeId,t),s=Object(z.b)(e.favoriteNodeId)?e.favoriteNodeId:"",d.label=1;case 1:return d.trys.push([1,8,,9]),o?[3,3]:(Object($.o)(Q,["SearchFolderDoesNotExist",n,s]),[4,w(r,e)]);case 2:return[2,d.sent()];case 3:return a?(Object($.o)(Q,["SearchFolderNeedsUpdate",n,s]),[4,T([o.FolderId.Id],!0)]):[3,6];case 4:return d.sent(),[4,w(r,e)];case 5:return[2,d.sent()];case 6:return Object($.o)(Q,["SearchFolderExists",n,s]),[2,o];case 7:return[3,9];case 8:throw c=d.sent(),new Error("Error when creating/deleting search folder for persona: "+c+". Source: "+n);case 9:return[2]}}))}))}var K=r(118);function W(){return Object(_.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(_.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,6]),[4,A()];case 1:return(t=r.sent())?(X(t),[2,t.FolderId.Id]):[4,Object(c.a)({Header:Object(d.a)(),Body:Object(n.a)({ParentFolderId:Object(s.a)({BaseFolderId:Object(a.a)({Id:"root"})}),Folders:[Object(o.a)({DisplayName:"FavoritePersonas",FolderClass:"IPF.Note"})]})}).then((function(e){var t=e.Body.ResponseMessages.Items[0];if("Error"===t.ResponseClass&&"ErrorFolderExists"===t.ResponseCode)throw i.g.warn('Folder "FavoritePersonas" already exists'),new Error("ErrorFolderExists");if("Success"!==t.ResponseClass)throw i.d('Error creating "FavoritePersonas" '+t.MessageText),t.MessageText;return t.Folders[0].FolderId.Id}))];case 2:return[2,r.sent()];case 3:return"ErrorFolderExists"!==(e=r.sent())?[3,5]:[4,A()];case 4:return X(t=r.sent()),[2,t.FolderId.Id];case 5:throw e;case 6:return[2]}}))}))}function X(e){if(null==e?void 0:e.ExtendedProperty){var t=e.ExtendedProperty.filter((function(e){var t;return(null===(t=e.ExtendedFieldURI)||void 0===t?void 0:t.PropertyTag)&&e.ExtendedFieldURI.PropertyTag.toLocaleLowerCase()===R})),r=t&&1===t.length?t[0].Value:"Property not found";Object(K.h)("RootFavoritePersonaFolderLoaded",{isFolderHidden:r})}}var Y=r(1947),Z=r(964),ee=r(7351),te=["deleteditems","conversationhistory","teamchat"];function re(e){var t=Object(D.a)({Items:e.map((function(e){return t=e,r="From",Object(U.a)({FieldURIOrConstant:Object(M.a)({Item:Object(C.a)({Value:t})}),Item:Object(j.a)({FieldURI:r})});var t,r}))}),r=Object(Y.a)({Items:te.map((function(e){var t,r,n=Object(Z.a)(e);return t=n,r="ParentFolderId",Object(ee.a)({FieldURIOrConstant:Object(M.a)({Item:Object(C.a)({Value:t})}),Item:Object(j.a)({FieldURI:r})})}))}),n=Object(Y.a)({Items:[t,r]});return Object(V.a)({Item:n})}r.d(t,"c",(function(){return T})),r.d(t,"d",(function(){return v})),r.d(t,"g",(function(){return L})),r.d(t,"h",(function(){return k})),r.d(t,"f",(function(){return J})),r.d(t,"e",(function(){return W})),r.d(t,"b",(function(){return re})),r.d(t,"a",(function(){return te}))},7350:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"DeleteFolderRequest:#Exchange"},e)}},7351:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"IsNotEqualTo:#Exchange"},e)}},7792:function(e,t,r){"use strict";var n=r(25),a=r(0);function o(e,t){var r;return void 0===e||e.__type||(r=e,e=Object(a.__assign)({__type:"DeleteFolderJsonRequest:#Exchange"},r)),Object(n.a)("DeleteFolder",e,t)}r.d(t,"a",(function(){return o}))},7989:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"CreateFolderRequest:#Exchange"},e)}},7990:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(25),a=r(7991);function o(e,t){return void 0===e||e.__type||(e=Object(a.a)(e)),Object(n.a)("CreateFolder",e,t)}},7991:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(0);function a(e){return Object(n.__assign)({__type:"CreateFolderJsonRequest:#Exchange"},e)}}}]);
//# sourceMappingURL=owa.FolderForestActions~MailFavoritesStore~MailFolderView.js.map
self.scriptsLoaded['owa.FolderForestActions~MailFavoritesStore~MailFolderView.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.FolderForestActions~MailFavoritesStore~MailFolderView.js'] = (new Date()).getTime();