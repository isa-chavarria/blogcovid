self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.InlineImageLoader.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[353],{1229:function(e,t,n){"use strict";n.d(t,"e",(function(){return"{id}"})),n.d(t,"f",(function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7"})),n.d(t,"a",(function(){return"data-custom"})),n.d(t,"c",(function(){return"originalsrc"})),n.d(t,"b",(function(){return"data-loadstatus"})),n.d(t,"d",(function(){return"pending"}))},1283:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(315);function o(e){return{headers:Object(r.f)(e,"GroupMailbox")}}},1341:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1283),o=n(106),i={};function a(e){var t=e.toLocaleLowerCase();if(!i[t]){var n={type:o.a.GroupMailbox,userIdentity:Object(o.e)().userIdentity,mailboxSmtpAddress:e,routingKey:Object(o.c)()+e,requestOptions:Object(r.a)(e)};i[t]=n}return i[t]}},1395:function(e,t,n){"use strict";var r=n(239),o=n(0),i={};function a(e){return i[e]}function u(e,t){var n=i[e];i[e]=Object(o.__assign)(Object(o.__assign)({},n),t)}var c=n(94),s=n(25);var d=n(254),l=n(75),f=n(528),m=n(427),h=n(353);function b(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return(t={}).headers=new Headers,[4,Object(m.a)(e)];case 1:return n=r.sent(),Object(h.b)(t.headers,n),[2,t]}}))}))}var g=Object(f.b)({timeBetweenRetryInMS:function(){return 3e4}});function v(e,t){t=t<1?1:t,setInterval((function(){!function(e){Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n,i,c,f,m,h=this;return Object(o.__generator)(this,(function(v){switch(v.label){case 0:if(t=function(){return Object(o.__awaiter)(h,void 0,void 0,(function(){var t,n;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),t={},Object(r.p)(e.userIdentity)?[4,b(e.userIdentity)]:[3,2];case 1:t=o.sent(),o.label=2;case 2:return[2,(i=t,Object(s.a)("GetAttachmentDownloadToken",{},i))];case 3:throw n=o.sent(),l.g.warn("Unable to get the download token "+n),n.networkError=!0,n;case 4:return[2]}var i}))}))},null==(n=a(e.userIdentity))?void 0:n.isRefreshingDownloadToken)return[3,4];u(e.userIdentity,{isRefreshingDownloadToken:!0}),i=0,c=g((function(){return Object(o.__awaiter)(h,void 0,void 0,(function(){var n;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return i++,[4,t()];case 1:return n=r.sent(),l.g.info("update new token"),u(e.userIdentity,{downloadToken:n,isRefreshingDownloadToken:!1}),[2]}}))}))})).retriableFunc,f=new d.b("AttachmentRefreshDownloadToken"),v.label=1;case 1:return v.trys.push([1,3,,4]),[4,c()];case 2:return v.sent(),f.addCustomData([i]),f.end(),[3,4];case 3:return m=v.sent(),l.g.warn("Retry to refresh token failed: "+m),f.addCustomData([i]),f.endWithError("ServerError",m),u(e.userIdentity,{isRefreshingDownloadToken:!1}),[3,4];case 4:return[2]}}))}))}(e)}),6e4*t)}var p=n(314);function O(e){var t=Object(r.g)(null==e?void 0:e.userIdentity),n=a(null==e?void 0:e.userIdentity);if((null==n?void 0:n.downloadToken)&&(null==n?void 0:n.downloadUrlBase))return n;switch(t){case null:case"Outlook":!function(e){var t=Object(r.p)(e.userIdentity)?Object(c.j)(e.userIdentity):Object(c.i)(),n=null==t?void 0:t.ApplicationSettings;if(n){var o=n.DownloadUrlBase;u(e.userIdentity,{downloadUrlBase:o,downloadToken:n.FirstDownloadToken}),o&&v(e,n.DownloadTokenRefreshMinutes)}}(e);break;case"Google":case"ICloud":break;default:Object(p.a)(t)}var o=a(e.userIdentity);return o||(Object(d.o)("FilesUrlDataNotFound",{accountProviderType:t}),l.g.warn("Unable to get the url data")),o}function y(e){if(!e)return null;var t=O(e);return null==t?void 0:t.downloadToken}n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return y}))},1437:function(e,t,n){"use strict";n.d(t,"k",(function(){return r})),n.d(t,"j",(function(){return o})),n.d(t,"g",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return u})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return d})),n.d(t,"i",(function(){return l})),n.d(t,"b",(function(){return f})),n.d(t,"h",(function(){return m}));var r="SwitchGroup",o="NavigateFromMeToWe",i="GroupHeader_SendEmail_Button_Clicked",a="GroupHeader_Email_Button_Clicked",u="GroupHeader_Files_Button_Clicked",c="GroupHeader_Calendar_Button_Clicked",s="GroupHeader_Notebook_Button_Clicked",d="GroupHeader_Planner_Button_Clicked",l="GroupHeader_Site_Button_Clicked",f="GroupHeader_CustomLeaveGroup_Button_Clicked",m="GroupHeader_Settings_Button_Clicked"},15574:function(e,t,n){"use strict";n.r(t);var r=n(1524),o=n(284),i=Object(o.action)("clearInlineImageStore")((function(){r.a.inlineImages={}})),a=n(2111),u=n(2522),c=n(4358),s=Object(o.action)("addInlineImageToStore")((function(e,t){r.a.inlineImages[e]=t})),d=n(1229);function l(e){var t=Object(u.a)(e,a.f),n=Object(u.a)(e,d.c);if(t.length>0&&n.length>0){var r=Object(c.a)(e);r&&s(n,r)}}function f(e,t,n,r,o,i,a){void 0===r&&(r=""),void 0===o&&(o=""),void 0===i&&(i=""),void 0===a&&(a=""),e.addCustomData([t,n,r,o,i,a]),r&&r.length>0?e.endWithError("ClientError"):e.end()}var m="RequestError",h="RequestTimeout",b="RequestAbort",g="ImageZeroBytes",v="ImageInvalidLength",p=[{format:"JPEG",signature:new Uint8Array([255,216,255,224]),mime:/^image\/p?jpe?g$/i,expectedMime:"image/jpeg"},{format:"EXIF",signature:new Uint8Array([255,216,255,225]),mime:/^image\/p?jpe?g$/i},{format:"SPIFF",signature:new Uint8Array([255,216,255,232]),mime:/^image\/p?jpe?g$/i},{format:"CannonEOS",signature:new Uint8Array([255,216,255,226]),mime:/^image\/p?jpe?g$/i},{format:"SamsungD500",signature:new Uint8Array([255,216,255,227]),mime:/^image\/p?jpe?g$/i},{format:"PNG",signature:new Uint8Array([137,80,78,71,13,10,26,10]),mime:/^image\/png$/i,expectedMime:"image/png"},{format:"GIF",signature:new Uint8Array([71,73,70,56]),mime:/^image\/gif$/i,expectedMime:"image/gif"},{format:"TIFF1",signature:new Uint8Array([73,32,73]),mime:/^image\/(x-)?tiff$/i},{format:"TIFF2",signature:new Uint8Array([73,73,42,0]),mime:/^image\/(x-)?tiff$/i},{format:"TIFF3",signature:new Uint8Array([77,77,0,42]),mime:/^image\/(x-)?tiff$/i},{format:"TIFF4",signature:new Uint8Array([77,77,0,43]),mime:/^image\/(x-)?tiff$/i},{format:"BMP",signature:new Uint8Array([66,77]),mime:/^image\/bmp$/i}];function O(e,t){return void 0===t&&(t=!1),new Promise((function(n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){var e=r.status,t=r.getResponseHeader("Content-Type")||"";if(t.length>0){var o=t.indexOf(";");o>0&&(t=t.substr(0,o))}var i="",u=null,c="",s=!1,d="";if(200==e){var l=r.response;if(l&&0!=l.byteLength)if(l.byteLength<10)i=v;else{var f=function(e){for(var t=0;t<p.length;t++)for(var n=p[t],r=0;r<n.signature.length&&n.signature[r]==e[r];r++)if(r==n.signature.length-1)return n;return null}(u=new Uint8Array(r.response,0,10));f&&(c=f.format,(s=t&&f.mime.test(t))||(i=a.l,d=f.expectedMime))}else i=g}n({status:i,responseCode:e,contentType:t,detectedFormat:c,first10BytesBase64:u?y(u):"",mimeMatched:s,expectedMime:d})}},r.ontimeout=function(){n({status:h})},r.onerror=function(){n({status:m})},r.onabort=function(){n({status:b})},t&&(r.withCredentials=!0),r.open("GET",e,!0),r.responseType="arraybuffer",r.send()}))}function y(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}var w=new RegExp("^https?://([^/]*)/.*","i"),j=window.location.hostname.toLowerCase();function C(e){if(e){var t=e.ownerDocument||document;return t&&t.documentElement.contains(e)}return!1}var A="onload";function k(e,t,n,r){e.onload=function(e){var t=e.target;_(t),n&&n(t)},e.onerror=function(e){var t=e.target;_(t),r&&r(t)},e.setAttribute(d.b,d.d),e.src=t}function _(e){e.removeAttribute(A),e.removeAttribute(d.b),e.onload=null,e.onerror=null}var T=n(573),I=n(75),x="deeplink/read/",S="/owa/?debugJS=true&viewmodel=ReadMessageItem&InternetMessageID=";function E(e,t,n,r){var o="Please engage nickhu@microsoft.com with below data:\n",i=Object(u.a)(e,a.e);i&&(o+="Deeplink (React): "+D(i,!0)+"\n");var c=Object(u.a)(e,a.d);c&&(o+="Deeplink (MVVM): "+D(c,!1)+"\n");var s=e.src;s&&(o+="Src: "+s+"\n");var l=Object(u.a)(e,d.c);if(l&&(o+="OriginalSrc: "+l+"\n"),n){var f=n.status,m=n.contentType,h=n.detectedFormat,b=n.first10BytesBase64;f&&(o+="Status: "+f+"\n"),m&&(o+="ContentType: "+m+"\n"),h&&(o+="DetectedFormat: "+h+"\n"),b&&(o+="First10Bytes: "+b+"\n"),o+="MimeMatch: "+n.mimeMatched}r&&r>0&&(o+="Retried: "+r),I.d("Error loading inline image: "+t+".\n"+o)}function D(e,t){void 0===t&&(t=!0);var n=Object(T.m)();return t?n+Object(T.k)()+x+e:n+S+e}var R=n(254),P=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}","i");function U(e,t,n,r,o,i,a,u,c,s,d,l,f,m){void 0===r&&(r=""),void 0===o&&(o=""),void 0===i&&(i=""),void 0===a&&(a=""),void 0===u&&(u=""),void 0===c&&(c=""),void 0===s&&(s=""),void 0===d&&(d=""),void 0===l&&(l=""),void 0===f&&(f=""),void 0===m&&(m="");var h=[e,t,n,r,o,i,a=function(e){if(!e)return"";var t="",n=e,r=e.indexOf(":");return r>=0&&(t=e.slice(0,r+1),n=e.slice(r+1)),t+(n=n.match(P)?"<GUID>":"<PII>")}(a),u,c,s,d,l,f,m];Object(R.o)("InlineImageLoadError",h),I.g.info("InlineImageLoadError: "+h)}var M,B=n(76),L="DataUri_Success",F="DataUri_RequestFailed",N="DataUri_OnError",G=new RegExp("^data:[a-z]+\\/[a-z-]+;","i");function W(e,t,n,r,o,i){n?r&&r(e):o&&o(e);var a=t.imageType,u=t.perfDataPoint,c=t.howLoad,s=t.context,d=t.loaderCode,l=t.originalSrc,m=t.owaDomain,h=t.downloadDomain,b=t.responseData,g=b.responseCode,v=b.status,p=b.contentType,O=b.detectedFormat,y=b.first10BytesBase64,w=b.mimeMatched,j=n?"":i||v||g.toString();u&&f(u,a,c,j,s,d,n?L:""),n||(U(a,c,j,g.toString(),s,d,l,p,m,h,O,y,w.toString()),Object(B.h)("mc-imageDiagnostics")&&E(e,j,b))}!function(e){e[e.NotStarted=0]="NotStarted",e[e.Pending=1]="Pending",e[e.Completed=2]="Completed"}(M||(M={}));var H=4,q=3,$=1e3,V=2e4,z="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7",X="RetryTimedOut",J=[],Q=null;function Z(e,t,n,r,o){var i={image:e,url:t,retryContext:n,currentRetry:0,status:M.NotStarted,whenQueued:Date.now(),onSuccessCallback:r,onErrorCallback:o};Y(i),J.push(i),Q||(Q=setTimeout((function(){return function e(){if(J.length>0){var t=Date.now(),n=[],r=[],o=[];J.forEach((function(e){e.status!=M.Completed&&(t-e.whenQueued>V?K(e,!1,X):e.status==M.Pending?(o.push(e),n.push(e)):e.status==M.NotStarted&&(r.push(e),n.push(e)))}));var i=H-o.length;i>0&&r.length>0&&(u=r.slice(0,Math.min(i,r.length)))&&u.length>0&&u.forEach((function(e){e.currentRetry++,e.status=M.Pending,C(e.image)?k(e.image,e.url,(function(t){K(e,!0)}),(function(t){e.currentRetry>=q?K(e,!1):Y(e)})):K(e,!1,a.k+"_R"+e.currentRetry)})),J=n}var u;Q=J.length>0?setTimeout((function(){return e()}),$):null}()}),$))}function Y(e){e.status=M.NotStarted,e.image.src=z}function K(e,t,n){if(void 0===n&&(n=""),e.status!=M.Completed){var r=e.image,o=e.onSuccessCallback,i=e.onErrorCallback,a=e.currentRetry;t?o&&o(r):i&&i(r);var u=e.retryContext,c=u.imageType,s=u.perfDataPoint,d=u.howLoad,l=u.context,m=u.loaderCode,h=u.originalSrc,b=u.owaDomain,g=u.downloadDomain,v=u.responseData,p=v.responseCode,O=v.status,y=v.contentType,w=v.detectedFormat,j=v.first10BytesBase64,C=v.mimeMatched,A=t?"":n||O||p.toString();s&&f(s,c,d,A,l,m,a.toString()),t||(U(c,d,A,p.toString(),l,m,h,y,b,g,w,j,C.toString(),a.toString()),Object(B.h)("mc-imageDiagnostics")&&200==p&&E(r,A,v)),e.status=M.Completed}}var ee="InlineImageLoad";function te(){return new R.a(ee,{logEvery:Object(B.h)("ring-dogfood")?1:20})}var ne="ZeroNaturalWidth";function re(e,t,n,r,o,i){void 0===i&&(i=!1);var c,s=te(),l=null!=(c=t.match(w))&&c.length>1&&c[1].toLowerCase()!=j,m=l?a.o:a.q,h=Object(u.a)(e,d.c),b=Object(u.a)(e,a.c);0==b.length&&(b=a.r);var g="";l&&(e.setAttribute(a.a,a.g),g=a.g),I.g.info("InlineImage: Load attachment, Url: "+t+", crossDomain: "+l+", crossOrigin: "+g);var v=l?j:"",p=l?function(e){var t=e.match(w);return null!=t&&t.length>1?t[1].toLowerCase():j}(t):"";k(e,t,(function(e){r&&r(e);var t=e.naturalWidth>0;f(s,b,m,t?"":ne,n,g),t||U(b,m,ne,"",n,g,h,"",v,p)}),(function(u){var c=a.n;n!=a.h||C(u)?O(t,l).then((function(d){if(i&&200==d.responseCode&&d.mimeMatched)Z(u,t,{imageType:b,howLoad:m,context:n,loaderCode:g,originalSrc:h,owaDomain:v,downloadDomain:p,responseData:d,perfDataPoint:s},r,o);else if(d.status==a.l&&d.expectedMime)!function(e,t,n,r,o){var i=new XMLHttpRequest;i.onload=function(){var t=new FileReader;t.onloadend=function(){if(t.result){var i=t.result.replace(G,"data:"+n.responseData.expectedMime+";");k(e,i,(function(){return W(e,n,!0,r,o)}),(function(){return W(e,n,!1,r,o,N)}))}},t.readAsDataURL(i.response)},i.ontimeout=i.onerror=function(){W(e,n,!1,r,o,F)},e.crossOrigin==a.g&&(i.withCredentials=!0),i.open("GET",t,!0),i.responseType="blob",i.send()}(u,t,{imageType:b,howLoad:m,context:n,loaderCode:g,originalSrc:h,owaDomain:v,downloadDomain:p,responseData:d,perfDataPoint:s},r,o);else{o&&o(u);var l=d.status,O=d.responseCode,y=d.contentType,w=d.detectedFormat,j=d.first10BytesBase64,C=d.mimeMatched;c=l||O.toString(),f(s,b,m,c,n,g),U(b,m,c,O.toString(),n,g,h,y,v,p,w,j,C.toString()),Object(B.h)("mc-imageDiagnostics")&&(404!=O&&0!=O&&200!=O||E(e,c,200==O?d:null))}})):(o&&o(u),c=a.k,f(s,b,m,c,n,g),U(b,m,c,"",n,g,h,"",v,p))}))}var oe=n(173),ie=n(9139),ae=n(1656),ue="naturalwidth",ce="naturalheight",se="width",de="height",le="px";function fe(e,t,n,o){void 0===n&&(n=!0);var i=Object(u.a)(e,d.a),c=Object(u.a)(e,a.c),s=Object(u.a)(e,d.c),l=s.length>0?r.a.inlineImages[s]:null;if(0==i.length&&!l)return!1;if(l){var m=te();k(e,l,(function(e){he(e),f(m,c,a.p,"",t)}),(function(e){f(m,c,a.p,a.n,t),U(c,a.p,a.n,"",t,"",s,"")}))}else{var h={Id:decodeURIComponent(i),mailboxInfo:Object(ie.a)(e,o)},b=Object(ae.a)(h.mailboxInfo.routingKey,h,1);if(null!=b&&b.length>0){var g=e.style.display,v=n?function(e){var t="50px",n="50px";e.style.width&&e.style.height?(t=e.style.width,n=e.style.height):e.getAttribute(se)&&e.getAttribute(de)?(t=e.getAttribute(se)+le,n=e.getAttribute(de)+le):e.getAttribute(ue)&&e.getAttribute(ce)&&(t=e.getAttribute(ue)+le,n=e.getAttribute(ce)+le);var r=Object(oe.h)(),o=document.createElement("div");o.style.display="inline-block",o.style.width=t,o.style.height=n,o.style.maxWidth="100%",o.style.maxHeight=e.style.maxHeight,o.style.borderWidth="1px",o.style.borderStyle="dashed",o.style.borderColor=r.themePrimary,o.style.boxSizing="border-box",e.style.display="none",e.parentNode&&e.parentNode.insertBefore(o,e);if(e.getAttribute(ue)&&e.getAttribute(ce)){var i=Math.min(parseInt(o.style.width),o.offsetWidth);o.style.height=Math.ceil(i/parseInt(e.getAttribute(ue))*parseInt(e.getAttribute(ce))).toString()}return o}(e):null;re(e,b,t,(function(e){me(v),he(e),e.style.display=g}),(function(e){me(v),e.style.display="inline"}),!0)}else U(c,"",a.m,"",t,"",s,""),e.removeAttribute("src")}return!0}function me(e){(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}function he(e){var t=e.style;e.hasAttribute("width")||t.width||e.hasAttribute("height")||t.height||(t.maxWidth="100%",t.height="auto")}var be=n(0),ge=n(1302);var ve=n(715),pe=n(123),Oe=n(280);function ye(e,t){return Object(B.h)("rp-imageProxy-loadViaFetch")?function(e,t){return Object(be.__awaiter)(this,void 0,void 0,(function(){var n,r=this;return Object(be.__generator)(this,(function(o){switch(o.label){case 0:return[4,fetch(t)];case 1:return n=o.sent(),[4,new Promise((function(t){return Object(be.__awaiter)(r,void 0,void 0,(function(){var r,o;return Object(be.__generator)(this,(function(i){switch(i.label){case 0:return Object(Oe.a)(n.status)?[4,n.blob()]:[3,2];case 1:return r=i.sent(),o=URL.createObjectURL(r),e.src=o,e.onload=function(e){URL.revokeObjectURL(o),t({status:n.status,renderSuccess:!0,statusText:n.statusText,headers:n.headers})},e.onerror=function(e){t({status:n.status,renderSuccess:!1,statusText:n.statusText,headers:n.headers})},[3,3];case 2:t({status:n.status,renderSuccess:!1,statusText:n.statusText,headers:n.headers}),i.label=3;case 3:return[2]}}))}))}))];case 2:return[2,o.sent()]}}))}))}(e,t):function(e,t){return new Promise((function(n){e.onload=function(t){we(e),n({status:200,renderSuccess:!0})},e.onerror=function(t){we(e),n({status:500,renderSuccess:!1})},e.src=t}))}(e,t)}function we(e){e.onload=null,e.onerror=null}var je,Ce=n(94),Ae=n(2),ke=n(687),_e="loadFromImageProxy";function Te(e,t){if(t.proxyCount%t.logEvery!=0){var n=function(){return Promise.resolve()};return{endWithSuccess:n,endWithError:n,addCustomProperty:n,addCheckmark:n}}var r=(new Date).getTime(),o=new R.a(_e,{sessionSampleRate:10,logVerbose:!0});return o.addCustomData(Object.values(e)),o.endWithSuccess=function(){o.end(void 0,Object(ke.a)(r)?"BackgroundSuccess":"Success")},o}!function(e){e.ModelD="ModelD",e.ModelB="ModelB",e.Cosmic="Cosmic"}(je||(je={}));var Ie="p",xe="s",Se="c",Ee="b",De="statusCode",Re="https://imgproxy-{0}.services.web.outlook.com/proxy/?u={1}&t={2}&r={3}&s={4}",Pe="https://cosmic-{0}.office.net/imageproxy/proxy?u={1}&t={2}&r={3}&s={4}",Ue="https://outlookimageproxy.azurewebsites.net",Me="clientErrorReason",Be="serverErrorProxyCode";function Le(e,t,n){var r;return Object(be.__awaiter)(this,void 0,void 0,(function(){var o,i,a,c,s,l,f,m;return Object(be.__generator)(this,(function(h){switch(h.label){case 0:if(o=t?document.createElement("img"):e,!(i=Object(u.a)(e,d.c)))return[2,!1];if((a=Te({endpoint:Object(B.h)("rp-imageProxyOnCosmic")||Object(B.h)("rp-imageProxyOnCosmic-test")?je.Cosmic:je.ModelD},n)).addCustomProperty("isShadowTraffic",t),c=Object(be.__read)(Object(ve.getAccessTokenforResourceAsLazy)(Ue),2),s=c[0],l=c[1],a.addCustomProperty("tokenCache",s?"warm":"cold"),s)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,l];case 2:return s=h.sent(),[3,4];case 3:return h.sent(),a.addCustomProperty(Me,1),a.endWithError("ClientError"),[2,!1];case 4:if(a.addCheckmark("token_loaded"),!((s?s.length:0)>0))return[3,9];f=function(e,t,n){return Object(pe.a)(Object(B.h)("rp-imageProxyOnCosmic-test")||Object(B.h)("rp-imageProxyOnCosmic")?Pe:Re,Object(B.h)("rp-imageProxyOnCosmic-test")?"test":"Dogfood"==Object(Ae.r)()?"sdf":"prod",encodeURIComponent(e),encodeURIComponent(t),n?xe:Ie,Object(Ce.u)()?Se:Ee)}(i,s,t),h.label=5;case 5:return h.trys.push([5,7,,8]),[4,ye(o,f)];case 6:return m=h.sent(),a.addCustomProperty(De,m.status),m.renderSuccess?(a.endWithSuccess(),[2,!0]):(200===m.status?(a.addCustomProperty(Me,3),a.endWithError("ClientError")):(a.addCustomProperty(Be,Object(B.h)("rp-imageProxy-loadViaFetch")?(null===(r=null==m?void 0:m.headers)||void 0===r?void 0:r.get("x-proxy-errorcode"))||"EmptyXProxyErrorCode":"NoXProxyCodeAsViaTag"),a.endWithError("ServerError")),[3,8]);case 7:return h.sent(),a.addCustomProperty(Me,4),a.endWithError("ClientError"),[3,8];case 8:return[3,10];case 9:a.addCustomProperty(Me,2),a.endWithError("ClientError"),h.label=10;case 10:return[2,!1]}}))}))}var Fe=n(3240),Ne="statusCode";function Ge(e,t,n){return Object(be.__awaiter)(this,void 0,void 0,(function(){var r,o,i,a;return Object(be.__generator)(this,(function(u){switch(u.label){case 0:(r=Te({endpoint:je.ModelB},n)).addCustomProperty("isShadowTraffic",t),u.label=1;case 1:return u.trys.push([1,6,,7]),[4,Object(Fe.a)(e)];case 2:return(o=u.sent())?[4,ye(t?document.createElement("img"):e,o)]:[3,4];case 3:return i=u.sent(),r.addCustomProperty(Ne,i.status),200===i.status?(r.endWithSuccess(),[2,!0]):(i.status>=400&&i.status<500?r.endWithError("ClientError"):r.endWithError("ServerError"),[3,5]);case 4:r.endWithError("ClientError"),u.label=5;case 5:return[3,7];case 6:return a=u.sent(),I.d(a),r.endWithError("ClientError"),[3,7];case 7:return[2,!1]}}))}))}var We=0,He=10;function qe(){var e={proxyCount:We,logEvery:He};return We++,e}function $e(e){return Object(be.__awaiter)(this,void 0,void 0,(function(){var t;return Object(be.__generator)(this,(function(n){switch(n.label){case 0:return r=e,o=Object(u.a)(r,d.c),i=Object(u.a)(r,a.b),o&&i?Object(ge.a)()?(t=!1,Object(B.h)("rp-imageProxyOnModelD")?[4,Le(e,t,qe())]:[3,2]):[3,5]:[2,!1];case 1:return n.sent(),Object(B.h)("rp-imageProxyOnModelBShadowing")&&Ge(e,!t,qe()),[3,4];case 2:return[4,Ge(e,t,qe())];case 3:n.sent(),Object(B.h)("rp-imageProxyOnModelDShadowing")&&Le(e,!t,qe()),n.label=4;case 4:return[3,6];case 5:e.src="",n.label=6;case 6:return[2,!0]}var r,o,i}))}))}var Ve="data-imageerror",ze="data-outlook-trace",Xe="CidTildeWrd",Je="AttNotFound",Qe=new RegExp("^cid:\\s?~WRD","i"),Ze=new RegExp("^cid:","i"),Ye=new RegExp("f:([0-9]+)","i"),Ke=new RegExp("t:([0-9]+)","i");function et(e,t){var n=Object(u.a)(e,Ve),r=Object(u.a)(e,a.c),o=Object(u.a)(e,d.c);if(n&&n.length>0){var i=n;if(o&&Qe.test(o))i=Xe;else if(n==Je){var c=function(e){var t="";if(e){var n=Ye.exec(e),r=Ke.exec(e);if(n&&2==n.length&&r&&2==r.length){var o=parseInt(n[1]),i=parseInt(r[1]);isNaN(o)||isNaN(i)||(0==o?t="PreEWS":o>0&&(o<i?t="MidEWS":o==i&&(t="PostEWS")))}}else t="NoTrace";return t}(Object(u.a)(e,ze));c&&(i=Je+"_"+c)}!function(e,t,n,r,o,i){void 0===n&&(n=""),void 0===r&&(r=""),void 0===o&&(o=""),void 0===i&&(i="");var a=te(),u=[e,t,n,r,o,i];a.addCustomData(u),n&&n.length>0?a.endWithError("ClientError"):a.end()}(r,"",i,t),U(r,"",i,"",t,"",o,""),e.onload=null,e.removeAttribute("src"),Object(B.h)("mc-imageDiagnostics")&&(n!=Je&&0!=n.indexOf("NotImage")||E(e,n))}else if(o&&!Ze.test(o)){var s=te();k(e,o,(function(e){f(s,r,"","",t)}),(function(e){f(s,r,"",a.n,t),O(o).then((function(e){var n=e.status,i=e.responseCode,a=e.contentType,u=n||i.toString();U(r,"",u,i.toString(),t,"",o,a)}))}))}}function tt(e,t,n,r){return Object(be.__awaiter)(this,void 0,void 0,(function(){var o;return Object(be.__generator)(this,(function(i){switch(i.label){case 0:return fe(e,o=t||"",!!n,r)?[3,2]:[4,$e(e)];case 1:i.sent()||et(e,o),i.label=2;case 2:return[2]}}))}))}function nt(e){var t=[e];Object(R.o)("InlineImageAttachmentUpload",t),I.g.info("InlineImageAttachmentUpload: "+t)}n.d(t,"clearInlineImageStore",(function(){return i})),n.d(t,"cacheInlineImage",(function(){return l})),n.d(t,"loadFromAttachmentServiceUrl",(function(){return re})),n.d(t,"loadFromAttachment",(function(){return fe})),n.d(t,"loadFromProxy",(function(){return $e})),n.d(t,"loadFromImageTag",(function(){return tt})),n.d(t,"logImageLoadError",(function(){return U})),n.d(t,"logImageUpload",(function(){return nt})),n.d(t,"tryCreateDataURIFromImage",(function(){return c.a}))},1621:function(e,t,n){"use strict";var r=n(314),o=n(10),i=n(37),a="/owa/",u="service.svc/s/GetFileAttachment?id={0}",c="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}",s="service.svc/s/GetAttachmentThumbnail?id={0}&thumbnailType=2",d="service.svc/s/GetReferenceAttachment?attachmentId={0}&location={1}&isImagePreview=True",l="service.svc/s/GetAttachmentThumbnail?id={0}",f="pdfprint.aspx?id={0}",m="pdfprint.aspx?id={0}&location={1}",h=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd",".tiff",".tif"];var b=n(296),g=n(49),v=n(2),p=n(22),O=n(1395),y=n(106),w=n(239);function j(e,t,n,u,s,l,f,b,g){var v;switch(void 0===s&&(s=0),void 0===l&&(l=0),void 0===f&&(f=!0),void 0===b&&(b=null),void 0===g&&(g=null),n){case 0:v=c;break;case 3:v=m;break;case 1:if(!function(e){if(!e)return!1;var t=null,n=e.lastIndexOf(".");return n>0&&(t=e.substr(n).toLowerCase()),!!t&&h.indexOf(t.toLowerCase())>=0}(b))return null;v=d;break;default:Object(r.a)(n)}var O=u?l:s;!O&&s&&(O=s);var y=Object(o.c)("{0}{1}{2}&permissionLevel={3}",a,g,Object(o.c)(v,encodeURIComponent(e.Id),encodeURIComponent(t)),O);f&&(y=y+"&X-OWA-CANARY="+Object(i.a)());return Object(p.a)(y)}function C(e,t,n,c,d){var m;switch(void 0===c&&(c=!1),void 0===d&&(d=!0),n){case 0:m=u;break;case 1:m=s;break;case 2:m=l;break;case 3:m=f;break;default:return Object(r.a)(n)}if(!Object(o.f)(m)){var h=function(e,t,n,r,u){if(void 0===u&&(u=!1),!t||!t.Id||!t.mailboxInfo)return null;var c=t.mailboxInfo.userIdentity,s=c&&Object(w.p)(c),d=t.mailboxInfo.type===y.a.GroupMailbox,l=s&&!d?Object(y.c)(t.mailboxInfo.mailboxSmtpAddress)+c:e,f=Object(O.b)(t.mailboxInfo),m=null==f?void 0:f.downloadUrlBase,h=Object(o.c)(n,encodeURIComponent(t.Id));if(!m||u&&"Firefox"===Object(g.a)().browser){var j=a+h+"&X-OWA-CANARY="+Object(i.a)();return Object(p.a)(j)}var C="{0}{1}/{2}&owa={3}&scriptVer={4}";Object(b.a)()&&(C+="&isc=1");var A=Object(o.c)(C,m,l,h,window.location.hostname,Object(v.l)()||"unofficial");return r&&(A+="&X-OWA-CANARY="+Object(i.a)(),A+="&token="+(null==f?void 0:f.downloadToken)),A}(e,t,m,d,3===n);return Object(o.c)("{0}{1}{2}",h,c?"&isDownload=true":"","&animation=true")}return null}n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return C}))},1642:function(e,t,n){"use strict";var r=n(1283),o=n(1341),i=n(4),a=Object(i.action)("EDIT_GROUP_SUCCESS",(function(e,t){return{groupSmtp:e,photoUrl:t}})),u=Object(i.action)("ADD_GROUP_MEMBER_SUCCESS",(function(e){return{groupSmtp:e}})),c=Object(i.action)("POPUP_OPENED",(function(){return{isOpen:!0}})),s=Object(i.action)("POPUP_CLOSED",(function(){return{isOpen:!1}})),d=Object(i.action)("DELETE_GROUP_SUCCESS",(function(e){return{groupSmtp:e}})),l=n(1437);n.d(t,"n",(function(){return r.a})),n.d(t,"m",(function(){return o.a})),n.d(t,"l",(function(){return a})),n.d(t,"j",(function(){return u})),n.d(t,"p",(function(){return c})),n.d(t,"o",(function(){return s})),n.d(t,"k",(function(){return d})),n.d(t,"g",(function(){return l.g})),n.d(t,"c",(function(){return l.c})),n.d(t,"d",(function(){return l.d})),n.d(t,"a",(function(){return l.a})),n.d(t,"e",(function(){return l.e})),n.d(t,"f",(function(){return l.f})),n.d(t,"i",(function(){return l.i})),n.d(t,"b",(function(){return l.b})),n.d(t,"h",(function(){return l.h}))},1656:function(e,t,n){"use strict";var r=n(1621);n.d(t,"a",(function(){return r.a})),n.d(t,"b",(function(){return r.b}));var o=n(1395);n.d(t,"c",(function(){return o.a}))},2111:function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return a})),n.d(t,"d",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return s})),n.d(t,"r",(function(){return d})),n.d(t,"n",(function(){return l})),n.d(t,"m",(function(){return f})),n.d(t,"k",(function(){return m})),n.d(t,"l",(function(){return h})),n.d(t,"h",(function(){return b})),n.d(t,"p",(function(){return g})),n.d(t,"o",(function(){return v})),n.d(t,"q",(function(){return p})),n.d(t,"j",(function(){return O})),n.d(t,"i",(function(){return y}));var r="src",o="data-imagetype",i="crossorigin",a="data-itemid",u="data-inetid",c="data-imageproxyendpoint",s="use-credentials",d="AttachmentByCid",l="OnError",f="NullAttachmentUrl",m="DOMDetached",h="ImageMismatch",b="RP",g="DataUri",v="CrossDomain",p="SameDomain",O="ImageProxySkipForConsumerChild",y="ImageProxyConnectorsAuthTokenFalse"},240:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,o=!1;function i(t){r--,delete e[t]}this.put=function(t,n,o,a){if(void 0!==o&&("number"!=typeof o||isNaN(o)||o<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==a&&"function"!=typeof a)throw new Error("Cache timeout callback must be a function");var u=e[t];u?clearTimeout(u.timeout):r++;var c={value:n,expire:o+Date.now()};return isNaN(c.expire)||(c.timeout=setTimeout(function(){i(t),a&&a(t,n)}.bind(this),o)),e[t]=c,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&i(t),n},this.clear=function(){for(var i in e)clearTimeout(e[i].timeout);r=0,e=Object.create(null),o&&(t=0,n=0)},this.get=function(i){var a=e[i];if(void 0!==a){if(isNaN(a.expire)||a.expire>=Date.now())return o&&t++,a.value;o&&n++,r--,delete e[i]}else o&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){o=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),o=Date.now(),i=n&&n.skipDuplicates;for(var a in r)if(r.hasOwnProperty(a)){if(i)if(e[a])continue;var u=r[a],c=u.expire-o;if(c<=0){this.del(a);continue}c=c>0?c:void 0,this.put(a,u.value,c)}return this.size()}}e.exports=new r,e.exports.Cache=r},2522:function(e,t,n){"use strict";function r(e,t){return e.hasAttribute(t)?e.getAttribute(t):""}n.d(t,"a",(function(){return r}))},280:function(e,t,n){"use strict";var r=n(576);n.d(t,"a",(function(){return r.a}))},2875:function(e,t,n){"use strict";var r,o,i,a=n(0),u=n(254),c=n(2897),s=n(2974),d=n(424),l=n(165),f="GetConnectorsLTITokenFailure",m="GetConnectorsLTITokenException",h="GetConnectorsLTITokenNull",b="ConnectorsLtiToken",g="40B852DF-9693-420D-AA7D-10072C9CE077",v=5;function p(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e;return Object(a.__generator)(this,(function(t){switch(t.label){case 0:return(e=function(){if(r){if(Date.now()-o<1e3*(r.TTL-v)*60)return r.TokenValue}return null}())?[3,2]:[4,O()];case 1:e=t.sent(),t.label=2;case 2:return[2,e]}}))}))}function O(){return i||(i=new Promise((function(e,t){var n={Header:Object(d.b)(),Body:Object(c.a)({TokenRequests:[{__type:"TokenRequest:#Exchange",Id:g,TokenType:"Connectors"}]})};Object(s.a)(n).then((function(n){i=null,n&&"Success"===n.Body.ResponseMessages.Items[0].ResponseClass?(r=n.Body.ResponseMessages.Items[0].Token,o=Date.now(),function(e){if(!e)throw y(h),new Error("getClientAuthToken null");l.set(b,e,{path:"/actions/"})}(r.TokenValue),e(r.TokenValue)):(y(f),t(new Error("getClientAuthToken failed")))})).catch((function(e){i=null,y(m),t(new Error("getClientAuthToken exception: "+e))}))}))),i}function y(e){Object(u.o)(e),r=void 0}var w=n(76),j=n(296),C=n(715),A="https://outlook.office365.com/connectors",k="User.Read";function _(){return Object(a.__awaiter)(this,void 0,void 0,(function(){return Object(a.__generator)(this,(function(e){switch(e.label){case 0:return!Object(w.h)("rp-actionableMessages-aad-token")||Object(j.a)()?[3,2]:[4,I()];case 1:return[2,e.sent()];case 2:return Object(w.h)("rp-actionableMessages-msa-token")&&Object(j.a)()?[4,T()]:[3,4];case 3:return[2,e.sent()];case 4:return[4,p()];case 5:return[2,e.sent()]}}))}))}function T(){return Object(a.__awaiter)(this,void 0,void 0,(function(){return Object(a.__generator)(this,(function(e){switch(e.label){case 0:return[4,Object(C.getDelegationTokenForOwa)(k)];case 1:return[2,e.sent()]}}))}))}function I(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return Object(a.__generator)(this,(function(r){switch(r.label){case 0:return e=Object(a.__read)(Object(C.getAccessTokenforResourceAsLazy)(A),2),t=e[0],n=e[1],t?[3,2]:[4,n];case 1:t=r.sent(),r.label=2;case 2:return[2,t]}}))}))}n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return _}))},2897:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(0);function o(e){return Object(r.__assign)({__type:"GetClientAccessTokenRequest:#Exchange"},e)}},2974:function(e,t,n){"use strict";var r=n(25),o=n(0);function i(e,t){var n;return void 0===e||e.__type||(n=e,e=Object(o.__assign)({__type:"GetClientAccessTokenJsonRequest:#Exchange"},n)),Object(r.a)("GetClientAccessToken",e,t)}n.d(t,"a",(function(){return i}))},3240:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n(0),o=n(2111),i=n(2875),a=n(60),u=n(26),c=n(254),s=n(2522),d=n(1229),l="data-connectorsauthtoken",f="u",m="i",h="d",b="ClientId";function g(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,h;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return t=Object(s.a)(e,d.c),n=Object(s.a)(e,o.b),i=Object(s.a)(e,l),t&&n?Object(u.a)().IsConsumerChild?(Object(c.o)(o.j),[2,t]):"1"!=i?[3,2]:[4,v(n,t)]:[2,""];case 1:return h=r.sent(),[3,3];case 2:h=function(e,t){var n=Object(a.a)(b);if(!n)return null;if("/actions/ei"==e.toLowerCase())return Object(c.o)(o.i),null;return e+"?"+f+"="+encodeURIComponent(t)+"&"+m+"="+encodeURIComponent(n)}(n,t),r.label=3;case 3:return[2,h]}}))}))}function v(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Object(i.b)()];case 1:return n.sent(),[3,3];case 2:return n.sent(),[2,null];case 3:return[2,e+"?"+f+"="+encodeURIComponent(t)+"&"+h+"="+encodeURIComponent((new Date).toISOString())]}}))}))}},424:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return c}));var r=n(274),o=n(305),i=n(304),a=n(298);function u(e){return Object(r.a)({RequestServerVersion:"Exchange2015",TimeZoneContext:Object(o.a)({TimeZoneDefinition:Object(i.a)({Id:null!=e?e:"Pacific Standard Time"})})})}function c(e,t,n){return Object(a.a)({PropertySetId:e,PropertyName:t,PropertyType:n})}},4358:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(254),o="2d",i="canvas",a="image/png";function u(e){try{var t=document.createElement(i),n=e.naturalWidth,u=e.naturalHeight;if(n>0&&u>0||(Object(r.o)("CreateDataURIMissingNaturalDimensions"),n=e.width,u=e.height),n>0&&u>0)return t.width=n,t.height=u,t.getContext(o).drawImage(e,0,0),t.toDataURL(a)}catch(e){}return null}},490:function(e,t,n){"use strict";var r=function(){function e(e,t,n){this.maxParallelTasks=e,this.taskCallback=t,this.taskDelay=n,this.taskList=[],this.numberOfTasksRunning=0}return e.prototype.add=function(e){this.taskList.unshift(e),this.scheduleTask()},e.prototype.clear=function(){this.taskList.splice(0,this.taskList.length)},e.prototype.canRunMoreTasks=function(){return this.numberOfTasksRunning<this.maxParallelTasks&&this.taskList.length>0},e.prototype.scheduleTask=function(){var e=this;this.canRunMoreTasks()&&setTimeout((function(){e.tryRunTask()}),this.taskDelay)},e.prototype.tryRunTask=function(){this.canRunMoreTasks()&&this.runTask()},e.prototype.onTaskComplete=function(){this.numberOfTasksRunning--,this.scheduleTask()},e.prototype.runTask=function(){var e=this,t=this.taskList.pop();this.numberOfTasksRunning++,this.taskCallback(t).then((function(){e.onTaskComplete()})).catch((function(){e.onTaskComplete()})),this.scheduleTask()},e}();n.d(t,"a",(function(){return r}))},528:function(e,t,n){"use strict";function r(e){void 0===e&&(e={}),function(e){e.timeBetweenRetryInMS=e.timeBetweenRetryInMS||function(){return 6e4}}(e);var t=e.maximumAttempts,n=e.timeBetweenRetryInMS;return function(e){var r=0,o=!1,i=function(a,u){o?u(new Error("The function retry was cancelled")):(r++,e().then((function(e){return a(e)})).catch((function(e){t&&r>=t?u(e):setTimeout((function(){return i(a,u)}),n(r))})))};return{retriableFunc:function(){return new Promise((function(e,t){return i(e,t)}))},cancel:function(){return o=!0}}}}function o(e){return function(t){return Math.pow(2,t)*e}}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o}))},576:function(e,t,n){"use strict";function r(e){return e>=200&&e<300}n.d(t,"a",(function(){return r}))},9139:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(10),o=n(1642),i=n(106),a=n(2522),u="explicitlogon";function c(e,t){var n=Object(a.a)(e,u);return Object(r.f)(n)?Object(i.e)(t):Object(o.m)(n)}}}]);
//# sourceMappingURL=owa.InlineImageLoader.js.map
self.scriptsLoaded['owa.InlineImageLoader.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.InlineImageLoader.js'] = (new Date()).getTime();